<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FBM+Perlin åœ°å½¢ç‚¹äº‘æ¸²æŸ“ (WebGPU) - æ¨¡å—åŒ–ç‰ˆæœ¬</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #0a0d12;
      color: #e6e6e6;
      font-family: "Segoe UI", system-ui, sans-serif;
    }

    #app {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #hud {
      position: absolute;
      left: 12px;
      top: 12px;
      z-index: 10;
      background: rgba(10, 13, 18, 0.94);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 14px 16px;
      width: 300px;
      max-height: calc(100vh - 24px);
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
    }

    #hud::-webkit-scrollbar {
      width: 6px;
    }

    #hud::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    #hud::-webkit-scrollbar-thumb {
      background: rgba(167, 139, 250, 0.4);
      border-radius: 3px;
    }

    #hud::-webkit-scrollbar-thumb:hover {
      background: rgba(167, 139, 250, 0.6);
    }

    #hud .title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #a78bfa;
    }

    #hud .section {
      margin-bottom: 12px;
    }

    #hud .section-title {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    #hud .row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }

    #hud .row.wrap {
      flex-wrap: wrap;
    }

    #hud label {
      font-size: 11px;
      color: #9ca3af;
      min-width: 70px;
    }

    #hud select,
    #hud input[type="range"] {
      flex: 1;
      padding: 6px 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      background: #111827;
      color: #e5e7eb;
      font-size: 12px;
    }

    #hud input[type="range"] {
      padding: 0;
      height: 6px;
      cursor: ew-resize;
    }

    #hud .value {
      min-width: 45px;
      text-align: right;
      font-size: 11px;
      color: #9ca3af;
      font-variant-numeric: tabular-nums;
    }

    #hud button {
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      background: #1f2937;
      color: #e5e7eb;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.15s;
    }

    #hud button:hover {
      border-color: #a78bfa;
      background: #2d3748;
    }

    #hud button.active {
      background: #4c1d95;
      border-color: #a78bfa;
    }

    #hud button.shape-btn {
      flex: 1;
      min-width: 70px;
    }

    #info {
      font-size: 11px;
      color: #9ca3af;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 8px;
      line-height: 1.8;
    }

    #info .row {
      display: flex;
      justify-content: space-between;
    }

    #info .highlight {
      color: #fbbf24;
      font-weight: 500;
    }

    #info .good {
      color: #34d399;
    }

    #info .warn {
      color: #fbbf24;
    }

    #hint {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 13, 18, 0.8);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 11px;
      color: #6b7280;
    }
  </style>
</head>

<body>
  <div id="app">
    <canvas id="canvas"></canvas>

    <div id="hud">
      <div class="title">ğŸ”ï¸ FBM+Perlin åœ°å½¢æ¢ç´¢</div>

      <div class="section">
        <div class="section-title">åœ°å½¢å‚æ•°</div>
        <div class="row">
          <label>ç‚¹æ•°é‡</label>
          <input type="range" id="countSlider" min="100000" max="1000000" step="100000" value="1000000" />
          <span class="value" id="countValue">100ä¸‡</span>
        </div>
        <div class="row">
          <label>ç‚¹å¤§å°</label>
          <input type="range" id="sizeSlider" min="0.5" max="5" step="0.1" value="1.5" />
          <span class="value" id="sizeValue">1.5</span>
        </div>
        <div class="row">
          <label>åŠ¨ç”»é€Ÿåº¦</label>
          <input type="range" id="speedSlider" min="0" max="2" step="0.1" value="0.5" />
          <span class="value" id="speedValue">0.5</span>
        </div>
        <div class="row">
          <label>é¢œè‰²æ–¹æ¡ˆ</label>
          <select id="colorScheme">
            <option value="position">ä½ç½®æ˜ å°„</option>
            <option value="normal">æ³•çº¿æ˜ å°„</option>
            <option value="height">é«˜åº¦æ˜ å°„</option>
            <option value="radial">å¾„å‘æ¸å˜</option>
            <option value="rainbow">å½©è™¹</option>
          </select>
        </div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ”¬ ç½‘æ ¼é‡å»º (WebGPU Marching Cubes)</div>
        <div class="row">
          <button id="meshToggle" class="physics-btn active">ç½‘æ ¼ï¼šå¼€</button>
          <button id="rebuildMesh" class="physics-btn">é‡å»º</button>
        </div>
        <div class="row">
          <label>ä½“ç´ åˆ†è¾¨ç‡</label>
          <input type="range" id="gridResSlider" min="32" max="256" step="8" value="160" />
          <span class="value" id="gridResValue">160Â³</span>
        </div>
        <div class="row">
          <label>ç­‰å€¼é¢é˜ˆå€¼</label>
          <input type="range" id="isoValueSlider" min="0.1" max="2.0" step="0.1" value="1.7" />
          <span class="value" id="isoValueValue">1.70</span>
        </div>
        <div class="row">
          <label>æ•£å°„åŠå¾„</label>
          <input type="range" id="splatRadiusSlider" min="0.5" max="3.0" step="0.1" value="3.0" />
          <span class="value" id="splatRadiusValue">3.0</span>
        </div>
        <div class="row">
          <label>ç½‘æ ¼é€æ˜åº¦</label>
          <input type="range" id="meshOpacitySlider" min="0.1" max="1.0" step="0.05" value="0.9" />
          <span class="value" id="meshOpacityValue">0.90</span>
        </div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ¾ çƒä½“ç‰©ç†å‚æ•°</div>
        <div class="row">
          <button id="resetBall" class="physics-btn">é‡ç½®çƒä½“</button>
        </div>
        <div class="row">
          <label>æ¨åŠ›</label>
          <input type="range" id="ballForceSlider" min="100" max="1000" step="50" value="400" />
          <span class="value" id="ballForceValue">400</span>
        </div>
        <div class="row">
          <label>è·³è·ƒåŠ›</label>
          <input type="range" id="ballJumpSlider" min="100" max="500" step="25" value="250" />
          <span class="value" id="ballJumpValue">250</span>
        </div>
        <div class="row">
          <label>é˜»å°¼</label>
          <input type="range" id="ballDampingSlider" min="0" max="1" step="0.05" value="0.3" />
          <span class="value" id="ballDampingValue">0.30</span>
        </div>
        <div class="row">
          <label>ç©ºä¸­æ§åˆ¶</label>
          <input type="range" id="ballAirSlider" min="0" max="1" step="0.1" value="0.6" />
          <span class="value" id="ballAirValue">0.60</span>
        </div>
        <div class="row">
          <label>æ‘©æ“¦åŠ›</label>
          <input type="range" id="ballFrictionSlider" min="0" max="1" step="0.1" value="0.5" />
          <span class="value" id="ballFrictionValue">0.50</span>
        </div>
        <div class="row">
          <label>å¼¹æ€§</label>
          <input type="range" id="ballRestitutionSlider" min="0" max="1" step="0.1" value="0.4" />
          <span class="value" id="ballRestitutionValue">0.40</span>
        </div>
      </div>

      <div id="info">
        <div class="row"><span>å½“å‰å½¢æ€</span><span class="highlight" id="infoShape">-</span></div>
        <div class="row"><span>ç‚¹æ•°é‡</span><span id="infoCount">0</span></div>
        <div class="row"><span>ç”Ÿæˆè€—æ—¶</span><span id="infoGenTime">0</span> ms</div>
        <div class="row"><span>æ¸²æŸ“æ¨¡å¼</span><span id="infoRenderMode">-</span></div>
        <div class="row"><span>ç½‘æ ¼é‡å»º</span><span id="infoMesh" class="good">-</span></div>
        <div class="row"><span>ç½‘æ ¼ä¸‰è§’å½¢</span><span id="infoTriangles">-</span></div>
        <div class="row"><span>FPS</span><span class="highlight" id="infoFps">0</span></div>
        <div class="row"><span>Draw Calls</span><span id="infoDrawCalls">0</span></div>
        <div class="row"><span>Compute è€—æ—¶</span><span id="infoComputeTime">-</span></div>
        <div class="row" style="margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.1);"><span>ğŸ¾
            ç‰©ç†å¼•æ“</span><span id="infoPhysics" class="good">-</span></div>
        <div class="row"><span>æ´»è·ƒç¢°æ’å—</span><span id="infoActiveChunks">-</span></div>
        <div class="row"><span>çƒä½“ä½ç½®</span><span id="infoBallPos">-</span></div>
      </div>
    </div>

    <div id="hint">å·¦é”®æ—‹è½¬ | å³é”®å¹³ç§» | æ»šè½®ç¼©æ”¾ | <span style="color:#fbbf24;">WASD æ§åˆ¶çƒä½“ç§»åŠ¨</span> | ç‚¹å‡»"ç½‘æ ¼"æŒ‰é’®å¯ç”¨ Marching Cubes ç½‘æ ¼é‡å»º
    </div>

    <div id="webgpu-status"
      style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#ef4444;padding:20px 30px;border-radius:10px;z-index:1000;display:none;">
      <p>ç½‘æ ¼é‡å»ºåŠŸèƒ½éœ€è¦ WebGPU æ”¯æŒã€‚<br>
        è¯·ä½¿ç”¨ Chrome 113+ æˆ– Edge 113+ æµè§ˆå™¨ã€‚</p>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.171.0/build/three.webgpu.js",
        "three/tsl": "https://unpkg.com/three@0.171.0/build/three.webgpu.js",
        "three/addons/": "https://unpkg.com/three@0.171.0/examples/jsm/",
        "@dimforge/rapier3d-compat": "https://esm.sh/@dimforge/rapier3d-compat@0.14.0"
      }
    }
  </script>

  <!-- ä¸»åº”ç”¨å…¥å£ - æ¨¡å—åŒ–ç‰ˆæœ¬ -->
  <script type="module" src="./modules/terrain-physics-app.js"></script>
</body>

</html>