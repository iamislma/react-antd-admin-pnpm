---
title: 海量点云模拟-LOD
atomId: PointCloudLod
package: three
description: 基于八叉树 LOD 的超大规模点云渲染组件，支持 2 亿级点云实时可视化
group:
  title: 3D可视化
---

# 海量点云模拟-LOD

> 基于八叉树（Octree）LOD 技术的超大规模点云渲染组件，通过动态细节层次控制实现 2 亿级点云的流畅渲染。

## 功能特性

- 🌲 **八叉树空间索引**：自动构建空间索引结构，支持高效的视锥剔除
- 📊 **LOD 动态调节**：基于屏幕空间误差（SSE）自动选择合适的细节层次
- 🎯 **点预算控制**：可配置渲染点数上限，保证帧率稳定
- 🔲 **框选支持**：支持框选点云，自动聚合到八叉树节点
- 🔍 **调试可视化**：可显示八叉树节点边界框，便于调试和理解
- ❄️ **LOD 冻结**：支持冻结当前 LOD 状态，用于性能分析
- 📈 **实时统计**：显示总点数、可见节点、渲染点数、内存占用等

## 技术架构

```txt
┌─────────────────────────────────────────────────────────┐
│                  PointCloudOctree                        │
├─────────────────────────────────────────────────────────┤
│  ├── OctreeNode[]        // 八叉树节点数组               │
│  │   ├── bounds          // AABB 包围盒                 │
│  │   ├── level           // 层级深度                    │
│  │   ├── pointCount      // 节点内点数                  │
│  │   └── children[]      // 子节点索引                  │
│  ├── LOD Controller      // LOD 控制器                  │
│  │   ├── SSE 计算                                       │
│  │   ├── 视锥剔除                                       │
│  │   └── 点预算分配                                     │
│  ├── SelectionManagerLod // 选择管理器                  │
│  │   └── 框选 → 节点映射                                │
│  └── OctreeHelper        // 调试可视化                  │
│      └── 节点边界框渲染                                  │
└─────────────────────────────────────────────────────────┘
```

## 核心算法

### 屏幕空间误差（SSE）

```txt
SSE = (节点包围盒投影大小 / 屏幕尺寸) × 常数因子

当 SSE > 阈值 时：展开子节点（更高精度）
当 SSE ≤ 阈值 时：使用当前节点（合并）
```

### 点预算分配

```txt
1. 按 SSE 降序排列可见节点
2. 从高 SSE 节点开始累加点数
3. 当累计点数达到预算时停止
4. 剩余节点不渲染
```

## 参数说明

| 参数 | 描述 | 类型 | 默认值 |
| --- | --- | --- | --- |
| totalPoints | 模拟总点数 | `number` | `200,000,000` |
| pointBudget | 渲染点数上限 | `number` | `2,000,000` |
| sseThreshold | SSE 阈值 | `number` | `1.0` |
| selectMode | 是否启用框选 | `boolean` | `true` |
| showOctree | 显示八叉树边界 | `boolean` | `false` |
| freezeLod | 冻结 LOD | `boolean` | `false` |

## 使用示例

```tsx | pure
import PointCloudLod from '@/views/compo/point-cloud-lod';

// 基本用法 - 直接路由访问
// 路由：/compo/point-cloud-lod

// 组件内部可配置参数：
// - 总点数：最高 2 亿
// - 点预算：控制实际渲染的点数上限
// - SSE 阈值：控制 LOD 切换灵敏度，值越小细节越高
// - 显示八叉树：调试时可查看空间划分
// - 冻结 LOD：固定当前层级不随视角变化
```

## 交互说明

| 操作 | 说明 |
| --- | --- |
| 左键拖拽 | 旋转视角，触发 LOD 重算 |
| 右键拖拽 | 平移视角 |
| 滚轮 | 缩放，影响 SSE 计算结果 |
| 左键框选 | 选择节点（需开启框选模式） |

## 性能指标

| 总点数 | 点预算 | 可见节点 | 帧率 |
| --- | --- | --- | --- |
| 1 亿 | 200 万 | ~50 | 60 FPS |
| 2 亿 | 200 万 | ~80 | 55+ FPS |
| 2 亿 | 500 万 | ~120 | 40+ FPS |

> 测试环境：GTX 1060 / Chrome 120 / 1080p

## 与基础点云渲染的区别

| 特性 | 点云渲染 | LOD 点云 |
| --- | --- | --- |
| 最大点数 | 5000 万 | 2 亿+ |
| 空间索引 | 分块 | 八叉树 |
| LOD 支持 | ❌ | ✅ |
| 内存占用 | 全量加载 | 按需加载 |
| 适用场景 | 中等规模 | 超大规模 |
